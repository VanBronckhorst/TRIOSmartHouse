class WashingMachine( const MaxPower,const MaxSlots,const MaxDelay):

signature:
visible:
    msgFromEMS,powerSupplied,requestTask,StartTask1,StartTask2;

domains:
	SlotsType: 1..MaxSlots;
	PowerType: 1..MaxPower;
	DelayType: 1..MaxDelay;
	Bool:0..1;
	TaskType: {May,Must};
	Resp: {Go,Warn};

items:

	/*

	*/
	event msgFromEMS(integer,Resp);
	/*
		Represents the amount of power given to the device at every moment
	*/
	state powerSupplied(PowerType);
	/*
		This event sends the task to the HAN at the moment it is scheduled to start
	*/
	event requestTask(integer,TaskType,PowerType,natural,SlotsType,DelayType,Bool);

	/*
	   Task 1 is a must task and its parameter is the delay for wich we want to schedule it
	*/
	event StartTask1(natural);

	/*
	 	Task 2 is a may task
	*/
	event StartTask2(natural);

axioms:

formulae:

	/*
		Defines the task id
	*/
	TaskIdDef:
		(requestTask(i,m,p,t,s,d,sh) & SomP(requestTask(i2,m2,p2,t2,s2,d2,sh2)) & all(i3)(i3>i2-> not ex(m3,p3,t3,s3,d3,sh3)(requestTask(i3,m3,p3,t3,s3,d3,sh3)) )) -> (i=i2+1) &
		(requestTask(i,m,p,t,s,d,sh) & not SomP(requestTask(i2,m2,p2,t2,s2,d2,sh2)) -> i=1;

	/*
		This formulae ensure that the task 1 is requested to the ems after the specified Delay Time
	*/
	ScheduleTask1:
		StartTask1(t) -> Futr(requestTask(i,Must,DEV_POW,TASK_TIME,1,0,0) ,t) &
		requestTask(i,Must,DEV_POW,1,0,0) -> ex(t1)( Past(StartTask1(t1),t1)); 

	/*
		This formulae ensure that the task 2 is requested to the ems after the specified Delay Time
	*/
	ScheduleTask2:
		StartTask2(t) -> Futr(requestTask(i,May,DEV_POW,TASK_TIME,3,300,0) ,t) &
		requestTask(i,May,DEV_POW,3,300,0) -> ex(t1)( Past(StartTask2(t1),t1));

	/*
		Ensures that if a must request has been sent the task will be executed
	*/
	MustInsurance:
		requestTask(i,Must,p,t,s,d,sh)-> Within(Lasts(powerSupplied=p,t),t+MAX_DELAY);

	/*
	    Ensures a response from the EMS in MAX_DELAY time
	*/	
	Response:
		requestTask(i,m,p,t,s,d,sh)-> Within(msgFromEMS(i,s),MAX_DELAY);

	ResponseStartSupply:
		msgFromEMS(i,Start)&requestTask(i,m,p,t,s,d,sh)-> Lasts(powerSupplied=p,t)
		 	